.. _lms-api-account-edx-label:

SEB Server Open edX Integration
===============================

SEB Server integrates with Open edX standard API for the following features:

- Course Access
- Login Name Resolving

.. note:: 
    If you want to use the automated SEB Client Restriction feature too, the `Open edX SEB Plugin <https://seb-server.readthedocs.io/en/latest/lmssetup.html#lms-setup-rest-plugin-label>`_ must be installed properly on the Assessment Tool.
    
Also refer to the Open edX API documentation for more information about the `Open edX REST API <https://courses.edx.org/api-docs/>`_
  

Create Open edX API Access Account
-----------------------------------

To be able to create an API access-account on Open edX you need a user-account with staff and administration privileges.

**For Open edX Hawthorn and Ironwood versions following the steps below::**

- Login to Open edX Assessment Tool Administration with an appropriate user-account that has administration rights. And find the Users section:

.. image:: images/lmssetup/openEdxAPIAccess1.bmp
    :align: center
    :target: https://raw.githubusercontent.com/SafeExamBrowser/seb-server/dev-2.0/docs/images/lmssetup/openEdxAPIAccess1.bmp
    
- Create a new User-Account that acts as an API account. The account must at least have the permissions to query the course API of Open edX and to access the seb_openedx plugin permission.
- Make sure that "Staff" status is checked for the account.

.. image:: images/lmssetup/openEdxAPIAccess2.bmp
    :align: center
    :target: https://raw.githubusercontent.com/SafeExamBrowser/seb-server/dev-2.0/docs/images/lmssetup/openEdxAPIAccess2.bmp
    
- Back in the administration homepage, find the OAUT2 - Client section and create a new API Client Access for the given User-Account. The Client id and Client secret are automatically generated by Open edx.

.. image:: images/lmssetup/openEdxAPIAccess3.bmp
    :align: center
    :target: https://raw.githubusercontent.com/SafeExamBrowser/seb-server/dev-2.0/docs/images/lmssetup/openEdxAPIAccess3.bmp
    
.. image:: images/lmssetup/openEdxAPIAccess4.bmp
    :align: center
    :target: https://raw.githubusercontent.com/SafeExamBrowser/seb-server/dev-2.0/docs/images/lmssetup/openEdxAPIAccess4.bmp

Once the client registration was successful the client id and client secret can be used within the SEB Server to access the course- and SEB-restriction API of Open edX as described in the next step section

.. note:: 
    Since Open edX Juniper is using Django Oauth Toolkit instead of Django Oauth Provider the last step in the above guide looks slightly different. Please see below the last step for setting up on an Open edX Juniper version.
    
- Back in the administration homepage, find the DJANGO OAUTH TOOLKIT - Applications section and create a new API Application Access for the given User-Account. The Client id can be defined and the Client secret is automatically be generated by Open edx.

.. image:: images/lmssetup/openEdxAPIAccess5.png
    :align: center
    :target: https://raw.githubusercontent.com/SafeExamBrowser/seb-server/dev-2.0/docs/images/lmssetup/openEdxAPIAccess5.png
    
.. image:: images/lmssetup/openEdxAPIAccess6.png
    :align: center
    :target: https://raw.githubusercontent.com/SafeExamBrowser/seb-server/dev-2.0/docs/images/lmssetup/openEdxAPIAccess6.png

.. _lms-setup-rest-plugin-label:

Install SEB restriction API plugin
----------------------------------

.. _lms-setup-edx-plugin-label:

**Open edX SEB Plugin**

    There is a SEB integration plugin developed and supported by `eduNEXT <https://www.edunext.co/>`_. 
     - `Documentation <https://seb-openedx.readthedocs.io/en/latest/>`_
     - `Repository <https://github.com/eduNEXT/seb-openedx>`_


.. _lms-setup-moodle-plugin-label:

**Moodle Plugin for SEB Server**

    There is a new SEB Server integration plugin for Moodle available since SEB Server 1.5 that can be used with the Assessment Tool Setup type Moodle with SEB Server Plugin.
    This Plugin supports and improves all common SEB Server Assessment Tool binding features such as Course-Access, SEB Restriction and Assessment Tool Session Name Resolving.
    It is also planed to extend and improve this plugin with new Moodle specific feature for further releases of SEB Server.
     - `Documentation <https://github.com/ethz-let/moodle-quizzaccess_sebserver>`_
     - `Repository <https://github.com/ethz-let/moodle-quizzaccess_sebserver>`_


Create a new Assessment Tool Setup for Open edX
-----------------------------------------------

A new Open edX system has been installed within your institution and to be able to use the system also for e-assessments with SEB and SEB Server,
you have to bind the Assessment Tool to the SEB Server.

- If not already done, install the `Open edX SEB Plugin <https://seb-server.readthedocs.io/en/latest/lmssetup.html#lms-setup-rest-plugin-label>`_  on the Open edX system first.
- If you don't already have an API access account on Open edX side, `create one <https://seb-server.readthedocs.io/en/latest/lmssetup.html#lms-api-account-edx-label>`_
- Sign into SEB Server with your institutional administrator role account.
- Navigate to "Exam Administration" / "Assessment Tool Setup" within the navigation on the left hand side.
- Use the "Add Assessment Tool Setup" action from the right action pane to open a Assessment Tool Setup creation form.
- Give a unique name to the new Assessment Tool Setup for internally identification.
- Set the main URL that points to the new Assessment Tool system. This is usually the URL that is also used with the Browser to connect to the main page of the Assessment Tool system
- Set the API credentials that has been creates within step two (client-id, secret).
- Use the "Activate Assessment Tool Setup" action on the right action pane to test, save and activate the new Assessment Tool Setup within one step.

.. note:: 
    If some form attributes are missing or not correct, the SEB Server system will respond with the usual form validation errors.
    If the connection to the Assessment Tool is failing because of missing or wrong credentials or for any other reason the system is not able to connect to the Assessment Tool
    the SEB Server will notify an error dialog to the user.


**Change API Credentials of an Active Assessment Tool Setup**

The API access account on the Assessment Tool has been expired and you have to create a new one or update the old one which both result in new API access credentials
that has to be set on the existing Assessment Tool Setup on the SEB Server.

.. image:: images/lmssetup/list.png
    :align: center
    :target: https://raw.githubusercontent.com/SafeExamBrowser/seb-server/dev-2.0/docs/images/lmssetup/list.png

- Sign into SEB Server with your institutional administrator role account.
- Navigate to "Exam Administration" / "Assessment Tool Setup" within the navigation on the left hand side.
- Use the Filter above the list to find the specified Assessment Tool Setup.
- Select the Assessment Tool Setup from the list and use the "Edit Assessment Tool Setup" action from the right action pane to open the Assessment Tool Setup in edit mode.
- Set the new credentials and make sure, the Assessment Tool Setup is still active.
- Use the "Save Assessment Tool Setup" action form the right action pane to save the changes and test the connection.

.. note:: 
    If some form attributes are missing or not correct, the SEB Server system will respond with the usual form validation errors.
    If the connection to the Assessment Tool is failing because of missing or wrong credentials or for any other reason the system is not able to connect to the Assessment Tool
    the SEB Server will notify an error dialog to the user.
    
 